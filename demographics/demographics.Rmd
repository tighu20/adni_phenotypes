---
title: "Demographics"
output: html_notebook
---

```{r}
library(dplyr)
library(ggplot2)
library(xtable)
library(janitor)
library(RSQLite)
```

ADNI demographics

```{r}
adnidata <- read.table("../data/adni_test_corrected.csv", header = TRUE, sep = ",")
adnidata <- rbind(adnidata,
                  read.table("../data/adni_train_corrected.csv", header = TRUE, sep = ","))


# Summarise
adnidata_summary <- adnidata %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = paste(round(mean(age, na.rm = TRUE), digits = 1),
                        paste("(", round(sd(age, na.rm = TRUE), digits = 1), ")", sep = "")),
            sex = paste(length(gender[gender=="Male"]),
                           length(gender[gender=="Female"]),
                           sep = "/"))
  
#datatable(adnidata_summary)

adnidata_summary_xtable <- xtable(adnidata_summary)
print(adnidata_summary_xtable,
      include.rownames = FALSE)

rm(list = c("adnidata",
            "adnidata_summary",
            "adnidata_summary_xtable"))
```

NACC demographics

```{r}
# import diagnoses
clinical_data_file = "../data/nacc_collatedResults.csv"
nacc_clindata = read.table(clinical_data_file, header = TRUE)

nacc_clindata_summary <- nacc_clindata %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = paste(round(mean(age, na.rm = TRUE), digits = 1),
                              paste("(", round(sd(age, na.rm = TRUE), digits = 1), ")", sep = "")),
            sex = paste(length(gender[gender=="Male"]),
                           length(gender[gender=="Female"]),
                           sep = "/"))

#datatable(nacc_clindata_summary)

nacc_clindata_summary_xtable <- xtable(nacc_clindata_summary)
print(nacc_clindata_summary_xtable,
      include.rownames = FALSE)

rm(list = c("nacc_clindata_summary",
            "nacc_clindata",
            "nacc_clindata_summary_xtable"))
```

UK biobank demographics

```{r}
# create sqlite connection
ukbb.db <- DBI::dbConnect(SQLite(),
                          "../data/ukb40183.db")

ukbb_data <- dbGetQuery(ukbb.db,
                        sql(paste("SELECT demogs.age, baseline.sex, clinicaldata.eid",
                                  "FROM clinicaldata",
                                  "JOIN demogs, baseline ON clinicaldata.eid = demogs.eid AND clinicaldata.visit = demogs.visit",
                                  "AND clinicaldata.eid = baseline.eid",
                                  "WHERE clinicaldata.t1_structural IS NOT ''")))


ukbb_data_summary <- ukbb_data %>%
  summarise(n = length(eid),
            age = paste(round(mean(age, na.rm = TRUE) / 365.25, digits = 1),
                        paste("(", round(sd(age / 365.25, na.rm = TRUE), digits = 1), ")", sep = "")),
            sex = paste(length(sex[sex=="0"]),
                           length(sex[sex =="1"]),
                           sep = "/"))

ukbb_data_summary_xtable <- xtable(ukbb_data_summary)
print(ukbb_data_summary_xtable,
      include.rownames = FALSE)

rm(list = c("ukbb_data",
            "ukbb_data_summary",
            "ukbb_data_summary_xtable"))
```