---
title: "Investigating the correlations of phenotyper score with clinical data in the NACC data"
output: html_notebook
---

This will investigate the relationship between the mean phenotype scores and clinical scores in the NACC dataset.

```{r}
library(dplyr)
library(stringr)
library(ggplot2)
library(DT)
library(brms)

set.seed(5)
```


```{r}
# import clinical scores
clinical_data_file = "../data/nacc_collatedResults.csv"

clindata = read.table(clinical_data_file, header = TRUE)

# remove volume and thickness measures
clindata <- clindata %>%
  select(colnames(.)[!grepl("volume", colnames(.))]) %>%
  select(colnames(.)[!grepl("thickness", colnames(.))])

# import results
# the '50' is the dropout results
results_file = "../results/latest_output_nacc_50.csv"
results = read.table(results_file, header = TRUE, sep = ",")
results <- results %>%
  mutate(subj = paste("sub-NACC", str_pad(nacc_id, width=6, side="left", pad="0"), sep = "")) %>%
  select(-nacc_id)

# diagnosis groups

diagnosis_map = list('Alzheimerâ€™s disease (AD)' = 'AD',
                     'Vascular brain injury or vascular dementia including stroke' = 'OD',
                     'Lewy body disease (LBD)' = 'OD', 
                     'Control' = 'Control', 
                     'Depression' = 'OND',
                     'Missing/unknown' = 'remove', ## <<---------- !
                     'Other neurologic, genetic, or infectious condition' = 'OND',
                     'Cognitive impairment for other specified reasons (i.e., written-in values)' = 'OND',
                     'Prion disease (CJD, other)' = 'OD', 
                     'FTLD, other' = 'OD', 
                     'Anxiety disorder' = 'OND',
                     'Corticobasal degeneration (CBD)' = 'OD',
                     'Cognitive impairment due to medications' = 'OND',
                     'Other psychiatric disease' = 'OND',
                     'Progressive supranuclear palsy (PSP)' = 'OD',
                     'Cognitive impairment due to systemic disease or medical illness' = 'OND',
                     'Traumatic brain injury (TBI)' = 'OND',
                     'Cognitive impairment due to alcohol abuse' = 'OND', 
                     'Bipolar disorder' = 'OND',
                     'Schizophrenia or other psychosis' = 'OND',
                     'FTLD with motor neuron disease (e.g., ALS)' = 'OD')

results <- results %>%
  left_join(clindata, by = "subj") %>%
  mutate(diagnosis = diagnosis_map[diagnosis]) %>%
  filter(diagnosis != "remove")

results$diagnosis <- factor(unlist(results$diagnosis),
                            levels = c("Control", "AD", "OD", "OND"))

rm(clindata)

```

# MMSE

First we'll plot MMSE against the mean

```{r}
naccmmse <- results %>%
  filter(!is.na(nacmmse))

naccmmse_summary <- naccmmse %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(naccmmse_summary)
```

```{r}
p_mmse <- ggplot(naccmmse, aes(x = mean, y = nacmmse, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

```{r}
# z-score mmse
mmse_mean = mean(naccmmse$nacmmse, na.rm = TRUE)
mmse_sd = sd(naccmmse$nacmmse, na.rm = TRUE)

naccmmse <- naccmmse %>%
  mutate(nacmmse = (nacmmse - mmse_mean) / mmse_sd)

# z-score mean
phenomean_mean = mean(naccmmse$mean, na.rm = TRUE)
phenomean_sd = sd(naccmmse$mean, na.rm = TRUE)

naccmmse <- naccmmse %>%
  mutate(mean = (mean - phenomean_mean) / phenomean_sd)

# set priors
mmse_prior = set_prior

anova_mmse <- brm(nacmmse ~ mean * diagnosis + age,
                  data = naccmmse,
                  prior = c(set_prior("cauchy(0,5)", class = "b")),
                  family = "skew_normal")

summary(anova_mmse)
```

```{r}
posterior <- as.array(anova_mmse)
posterior_plot <- mcmc_areas(posterior,
                  pars = get_variables(anova_mmse)[grepl("b_mean:", get_variables(anova_mmse))])
print(posterior_plot)

```


# MOCA

```{r}
naccmoca <- results %>%
  filter(!is.na(naccmoca))

naccmoca_summary <- naccmoca %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(naccmoca_summary)
```

```{r}
p_mmse <- ggplot(naccmoca, aes(x = mean, y = naccmoca, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# Digit span forward

```{r}
digif <- results %>%
  filter(!is.na(digif))

digif_summary <- digif %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(digif_summary)
```

```{r}
p_mmse <- ggplot(digif, aes(x = mean, y = digif, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# Digit span backwards 

```{r}
digib <- results %>%
  filter(!is.na(digib))

digib_summary <- digib %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(digib_summary)
```

```{r}
p_mmse <- ggplot(digib, aes(x = mean, y = digib, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# Animal fluency

```{r}
animals <- results %>%
  filter(!is.na(animals))

animals_summary <- animals %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(animals_summary)
```

```{r}
p_mmse <- ggplot(animals, aes(x = mean, y = animals, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# Trails B

```{r}
trialsb <- results %>%
  filter(!is.na(trialsb))

trialsb_summary <- trialsb %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(trialsb_summary)
```

```{r}
p_mmse <- ggplot(trialsb, aes(x = mean, y = trialsb, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# WAIS

```{r}
wais <- results %>%
  filter(!is.na(wais))

wais_summary <- wais %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(wais_summary)
```

```{r}
p_mmse <- ggplot(wais, aes(x = mean, y = wais, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```

# Boston naming task

```{r}
boston <- results %>%
  filter(!is.na(boston))

boston_summary <- boston %>%
  group_by(diagnosis) %>%
  summarise(n = length(subj),
            age = round(mean(age, na.rm = TRUE), digits = 1),
            sex = paste(length(gender[gender == "Female"]),
                        length(gender[gender == "Male"]),
                        sep = "/"))

datatable(boston_summary)
```

```{r}
p_mmse <- ggplot(boston, aes(x = mean, y = boston, group = diagnosis, colour = diagnosis))
p_mmse <- p_mmse + geom_point() + geom_smooth(method = lm)
print(p_mmse)
```